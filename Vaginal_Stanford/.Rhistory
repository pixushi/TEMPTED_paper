getwwd()
getwd()
res_aldex_all <- readRDS(file="result/res_aldex.RDS")
for (ii in 1:length(res_aldex_all)){
print(summary(res_aldex_all[[ii]]$we.eFDR))
}
tab0 <- NULL
res_aldex_all <- readRDS(file="result/res_aldex.RDS")
for (ii in 1:length(res_aldex_all)){
rbind(tab0, summary(res_aldex_all[[ii]]$we.eFDR))
}
tab0
res_aldex_all <- readRDS(file="result/res_aldex.RDS")
for (ii in 1:length(res_aldex_all)){
rbind(tab0, summary(res_aldex_all[[ii]]$we.eFDR))
}
tab0
tab0 <- rep(0,6)
res_aldex_all <- readRDS(file="result/res_aldex.RDS")
for (ii in 1:length(res_aldex_all)){
rbind(tab0, summary(res_aldex_all[[ii]]$we.eFDR))
}
tab0
rbind(tab0, summary(res_aldex_all[[ii]]$we.eFDR))
res_aldex_all <- readRDS(file="result/res_aldex.RDS")
for (ii in 1:length(res_aldex_all)){
tab0 <- rbind(tab0, summary(res_aldex_all[[ii]]$we.eFDR))
}
tab0 <- NULL
res_aldex_all <- readRDS(file="result/res_aldex.RDS")
for (ii in 1:length(res_aldex_all)){
tab0 <- rbind(tab0, summary(res_aldex_all[[ii]]$we.eFDR))
}
tab0
rownames(tab0) <- paste("week", 12:36)
rownames(tab0) <- paste("week", 12:35)
tab0
xtable::xtable(tan0)
xtable::xtable(tab0)
library(fgsea)
data(examplePathways)
data(exampleRanks)
set.seed(1234)
fgseaRes3 <- fgsea(examplePathways, exampleRanks, maxSize=500, eps=0)
set.seed(1234)
fgseaRes4 <- fgsea(examplePathways, exampleRanks, maxSize=500, eps=0)
merged.res.fgsea.seed <- merge( fgseaRes3, fgseaRes3, by.x="pathway", by.y="pathway")
plot(  merged.res.fgsea.seed$pval.x, merged.res.fgsea.seed$pval.y )
stats <- c(1,1.1,0.9,0.5,0,-0.1,0.1)
names(stats) <- paste0('g', 1:7)
pathways <- list(paste0("g",c(1,2,5)))
pathways
fgsea::fgsea(pathways = pathways, stats = stats, minSize = 0, maxSize = 100)
pathways <- list(latent1=paste0("g",c(1,2,5)))
pathways
fgsea::fgsea(pathways = pathways, stats = stats, minSize = 0, maxSize = 100)
fgsea::fgsea(pathways = pathways, stats = stats, minSize = 0, maxSize = 100)
set.seed(1);fgsea::fgsea(pathways = pathways, stats = stats, minSize = 0, maxSize = 100)
set.seed(1);fgsea::fgsea(pathways = pathways, stats = stats, minSize = 0, maxSize = 100)
set.seed(1);fgsea::fgsea(pathways = pathways, stats = stats, minSize = 0, maxSize = 100)
set.seed(0);fgsea::fgsea(pathways = pathways, stats = stats, minSize = 0, maxSize = 100)
citation("ALDEx2")
xtable::xtable(tab0)
table(meta_concise$WeekVsConc, meta_concise$PregOut)
meta_concise <- meta_tab[,c("PregID", "PregOut", "DayVsConc")]
load("data/data_post.RData")
metadata_all <- post.df %>%
filter(DayVsDel < 0, LibrarySize >= 4e4, PregOut!="Miscarriage") %>%
dplyr::select(Cohort, SampleID, PregID, DayVsConc, DayVsDel, PregOut, GDdel) %>%
group_by(PregID) %>% filter(n() > 1) %>% ungroup()
rm(list=ls())
# for data
library(qiime2R) # read in Qiime artifacts
library(dplyr) # data formatting
library(tidyverse) # data formatting
# for computing
library(reticulate) # run py codes
library(vegan) # distance matrix
library(PERMANOVA) # permanova
library(randomForest) # random forest
library(PRROC) # roc and pr
library(phyloseq) # phyloseq object
library(ALDEx2) # differential abundance
# for plotting
library(ggpubr)
library(ggplot2)
library(gridExtra)
library(RColorBrewer)
# set working directory to be where the current script is located
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
source('../TEMPTED.R')
color_RB <- brewer.pal(3,'Set1')[1:2]
# Get data in 2nd and 3rd trimester
load("data/data_post.RData")
metadata_all <- post.df %>%
filter(DayVsDel < 0, LibrarySize >= 4e4, PregOut!="Miscarriage") %>%
dplyr::select(Cohort, SampleID, PregID, DayVsConc, DayVsDel, PregOut, GDdel) %>%
group_by(PregID) %>% filter(n() > 1) %>% ungroup()
head(metadata_all)
metadata <- metadata_all %>% filter(DayVsConc >= 12*7, DayVsConc < 37*7)
ps_filtered <- prune_samples(metadata$SampleID, post.ps)
ps_filtered <- filter_taxa(ps_filtered, function(x) sum(x!=0) >= 5, TRUE)
count_tab <- data.frame(otu_table(ps_filtered))
meta_tab <- data.frame(sample_data(ps_filtered))
meta_concise <- meta_tab[,c("PregID", "PregOut", "DayVsConc")]
meta_concise <- meta_concise %>%
mutate(WeekVsConc=floor(DayVsConc/7)) %>%
dplyr::select(., -DayVsConc) %>%
distinct()
tm <- meta_concise$WeekVsConc
table(meta_concise$WeekVsConc, meta_concise$PregOut)
tab1 <- table(meta_concise$WeekVsConc, meta_concise$PregOut)
tab0
res_aldex_all <- readRDS(file="result/res_aldex.RDS")
for (ii in 1:length(res_aldex_all)){
print(summary(res_aldex_all[[ii]]$we.eFDR))
}
tab0 <- NULL
res_aldex_all <- readRDS(file="result/res_aldex.RDS")
for (ii in 1:length(res_aldex_all)){
+     tab0 <- rbind(tab0, summary(res_aldex_all[[ii]]$we.eFDR))
+ }
tab0 <- NULL
res_aldex_all <- readRDS(file="result/res_aldex.RDS")
for (ii in 1:length(res_aldex_all)){
tab0 <- rbind(tab0, summary(res_aldex_all[[ii]]$we.eFDR))
}
tab0
rownames(tab0) <- paste0("Week", 12:35)
tab0
rownames(tab0) <- paste("Week", 12:35)
tab0
tab1
xtable(cbind(tab0, tab1[-length(tab1)]))
tab1
xtable(cbind(tab0, tab1[-length(tab1),]))
tab1[-length(tab1),]
xtable(cbind(tab0, tab1[-nrow(tab1),]))
tab2 <- (cbind(tab0, tab1[-nrow(tab1),]))
tab2 <- as.data.frame(tab2)
tab2
xtable(tab2)
?xtable
class(tab2$Term)
class(tab2$Term) <- "integer"
class(tab2$Term)
class(tab2$Preterm) <- "integer"
xtable(tab2)
BiocManager::install("Maaslin2")
library(splines)
?bs
xx <- runif(100)
yy <- xx^3-xx^2+0.5*xx
yy <- xx^3-xx^2+0.5*xx+rnorm(100)
plot(xx,yy)
yy <- xx^3-xx^2+0.5*xx+rnorm(100)/2
plot(xx,yy)
yy <- xx^3-xx^2+0.5*xx+rnorm(100)/10
plot(xx,yy)
yy <- xx^3-xx^2+0.5*xx
plot(xx,yy)
yy <- xx^3-2*xx^2+0.5*xx
plot(xx,yy)
yy <- xx^3-1.5*xx^2+0.5*xx
plot(xx,yy)
yy <- xx^3-1.5*xx^2+0.5*xx+rnorm(100)
plot(xx,yy)
yy <- xx^3-1.5*xx^2+0.5*xx+rnorm(100)/5
plot(xx,yy)
yy <- xx^3-1.5*xx^2+0.5*xx+rnorm(100)/10
plot(xx,yy)
yy <- xx^3-1.5*xx^2+0.5*xx+rnorm(100)/20
plot(xx,yy)
yy <- xx^3-1.5*xx^2+0.5*xx+rnorm(100)/50
plot(xx,yy)
yy <- xx^3-1.5*xx^2+0.5*xx+rnorm(100)/30
plot(xx,yy)
tmp <- lm(yy ~ xx + bs(xx, df = 2))
tmp <- lm(yy ~ xx + bs(xx, df = 3))
summary(tmp)
tmp <- lm(yy ~  bs(xx, df = 3))
summary(tmp)
dat <- data.frame(xx=xx,yy=yy,id=rep(c(1:10,each=10)))
dat <- data.frame(xx=xx,yy=yy,id=rep(c(1:10,each=10)))
dat <- data.frame(xx=xx,yy=yy,id=rep(c(1:10),each=10))
tmp <- lmer(yy ~  bs(xx, df = 3) + (1|id), data=dat)
tmp <- lmer(yy ~  bs(xx, df = 3) + (1|id), data=dat)
library(lme4)
tmp <- lmer(yy ~  bs(xx, df = 3) + (1|id), data=dat)
summary(tmp)
dat <- data.frame(xx=xx,yy=yy,id=rep(c(1:10),each=10), trt=c(rep("A",50), rep("B",50)))
tmp <- lmer(yy ~  bs(xx, df = 3)*trt + (1|id), data=dat)
summary(tmp)
tmp <- lmer(yy ~  bs(xx, df = 3):trt + (1|id), data=dat)
summary(tmp)
